<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Life Grid</title>
    <style>
        :root {
            --bg-color: #f2f2f0;
            --ink-color: #2c3e50;
            --empty-color: #e3e3e3;
            --accent-color: #c0392b; 
            --milestone-color: #2980b9; 
            /* æ–°å¢ï¼šå‡ºç”Ÿå‘¨é¢œè‰² (æ—¥å‡ºé‡‘) */
            --birth-color: #f39c12; 
            --text-muted: #7f8c8d;
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        body {
            background-color: var(--bg-color);
            color: var(--ink-color);
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            height: 100vh;
            height: 100dvh; 
            overflow: hidden; 
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 1s ease-out;
        }

        /* --- ç”µè„‘ç«¯å¸ƒå±€ --- */
        .layout {
            display: flex;
            width: 90vw;
            height: 90vh;
            max-width: 1400px;
            gap: 60px;
            align-items: center;
        }
        .sidebar {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: left;
            min-width: 300px;
            animation: fadeIn 1s ease-out 0.2s backwards;
            position: relative;
        }
        .grid-container {
            flex: 1.5; 
            height: 100%; 
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 1.2s ease-out 0.5s backwards;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(52, 1fr);
            height: 100%; 
            aspect-ratio: 52 / 80; 
            gap: 2px;
            width: 100%;
        }
        .cell {
            background-color: var(--empty-color);
            border-radius: 0.5px;
            width: 100%;
            height: 100%;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .cell.past { background-color: var(--ink-color); }
        .cell.current { 
            background-color: var(--accent-color);
            box-shadow: 0 0 8px var(--accent-color);
            z-index: 2;
        }
        .cell.milestone { background-color: var(--milestone-color) !important; z-index: 1; }
        
        /* æ–°å¢ï¼šå‡ºç”Ÿå‘¨æ ·å¼ */
        .cell.birth { 
            background-color: var(--birth-color) !important; 
            z-index: 3; 
        }

        .cell:hover { transform: scale(1.8); z-index: 10; background-color: #dcdcdc; border-radius: 2px; }
        .cell.milestone:hover { transform: scale(2); z-index: 15; background-color: var(--milestone-color) !important; box-shadow: 0 4px 10px rgba(41, 128, 185, 0.4); }
        /* å‡ºç”Ÿå‘¨æ‚¬åœæ•ˆæœ */
        .cell.birth:hover {
            transform: scale(2);
            z-index: 15;
            background-color: var(--birth-color) !important;
            box-shadow: 0 4px 10px rgba(243, 156, 18, 0.4);
        }

        h1 { font-size: 2rem; font-weight: 400; letter-spacing: 1px; margin-bottom: 30px; text-transform: uppercase; color: var(--ink-color); }
        .soul-text { font-size: 1rem; line-height: 2; color: #666; margin-bottom: 40px; border-left: 3px solid var(--accent-color); padding-left: 20px; }
        .soul-text strong.black { color: var(--ink-color); font-weight: 600; }
        .soul-text strong.red { color: var(--accent-color); font-weight: 600; }
        .input-group label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1.5px; display: block; margin-bottom: 8px; color: #999; font-weight: 600; }
        input[type="date"] { background: transparent; border: none; border-bottom: 1px solid #ccc; font-size: 1.5rem; color: var(--ink-color); font-family: inherit; cursor: pointer; padding: 5px 0; outline: none; width: 100%; max-width: 220px; }
        .stats { margin-top: 20px; font-size: 0.9rem; color: #666; line-height: 1.5; }
        
        .hover-info { height: 30px; margin-top: 15px; font-weight: bold; font-size: 0.9rem; color: var(--accent-color); display: flex; align-items: center; }
        .hover-info.blue-text { color: var(--milestone-color); }
        /* æ–°å¢ï¼šé‡‘è‰²æ–‡å­—æ ·å¼ */
        .hover-info.gold-text { color: var(--birth-color); }

        .data-actions, .help-section { opacity: 0.4; transition: opacity 0.3s ease; }
        .data-actions:hover, .help-section:hover, .help-section.active { opacity: 1; }
        .data-actions { margin-top: 40px; display: flex; gap: 15px; }
        .action-btn { background: none; border: 1px solid var(--text-muted); color: var(--text-muted); font-size: 0.7rem; padding: 4px 10px; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; border-radius: 2px; font-family: inherit; }
        #fileInput { display: none; }
        .help-section { margin-top: 30px; font-size: 0.85rem; color: var(--text-muted); }
        .help-trigger { cursor: pointer; display: flex; align-items: center; gap: 5px; font-weight: 500; }
        .help-content { display: none; margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.03); border-radius: 4px; line-height: 1.6; color: #555; }
        .help-content.show { display: block; animation: fadeIn 0.3s; }
        .mobile-visible { display: none; }
        .mobile-hidden { display: inline; }

        /* =========================================
           ğŸ“± ç§»åŠ¨ç«¯é€‚é…
           ========================================= */
        @media (max-width: 768px) {
            body {
                display: block; 
                height: auto;
                min-height: 100vh;
                overflow-y: scroll;
                padding: 40px 25px;
                padding-top: max(40px, env(safe-area-inset-top));
            }

            .layout {
                flex-direction: column;
                width: 100%;
                height: auto;
                max-width: 500px; 
                margin: 0 auto;
                gap: 40px;
                padding-bottom: 120px;
            }

            .sidebar { width: 100%; padding-bottom: 0; min-width: 0; }
            h1 { font-size: 1.6rem; margin-bottom: 25px; }
            .soul-text { font-size: 0.95rem; line-height: 1.8; margin-bottom: 30px; border-left-width: 2px; padding-left: 15px; }
            .mobile-hidden { display: none; }
            .mobile-visible { display: block; }
            input[type="date"] { width: 100%; max-width: 100%; border-radius: 0; }

            .grid-container {
                display: block;
                width: 100%;
                height: auto;
                aspect-ratio: unset;
            }
            
            .grid {
                display: grid;
                grid-template-columns: repeat(52, 1fr);
                width: 100%;
                height: auto;
                aspect-ratio: unset;
                gap: 1px;
            }

            .cell {
                width: 100%;
                height: 0 !important; 
                padding-bottom: 100%;
                position: relative;
            }

            .cell.selected {
                transform: scale(1.4);
                z-index: 20;
                box-shadow: 0 0 0 1px rgba(255,255,255,0.8), 0 4px 10px rgba(0,0,0,0.2);
            }

            .hover-info {
                position: fixed;
                bottom: 30px;
                left: 50%;
                transform: translateX(-50%);
                width: max-content;
                max-width: 85%;
                background: var(--accent-color);
                color: #fff;
                padding: 12px 20px;
                border-radius: 30px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.3s;
                z-index: 9999;
                bottom: max(30px, env(safe-area-inset-bottom));
                white-space: nowrap;
                font-size: 0.85rem;
            }
            .hover-info.blue-text { color: #fff; background: var(--milestone-color); }
            /* æ–°å¢ï¼šæ‰‹æœºç«¯é‡‘è‰²èƒŒæ™¯ */
            .hover-info.gold-text { color: #fff; background: var(--birth-color); }
            .hover-info:not(:empty) { opacity: 1; }

            .data-actions, .help-section { margin-top: 20px; opacity: 0.6; }
        }
        
        @media print {
            body { background-color: #fff; height: auto; overflow: visible; display: block; padding: 0; }
            .layout { width: 100%; height: auto; max-width: none; flex-direction: column; align-items: flex-start; gap: 20px; padding: 40px; }
            .input-group, .hover-info, input, .data-actions, .help-section { display: none !important; }
            .input-group::after { content: "DATE OF BIRTH: 1995-01-01"; display: block; font-size: 0.9rem; color: #000; margin-top: 10px; }
            .sidebar, .grid-container { animation: none; width: 100%; }
            .cell { -webkit-print-color-adjust: exact; print-color-adjust: exact; padding-bottom: 0; height: 100%; }
            .soul-text { border-color: #000; color: #000; }
            h1 { color: #000; }
            .grid { aspect-ratio: 52 / 80; gap: 1px; border: 1px solid #eee; }
        }
    </style>
</head>
<body>
    <div class="layout">
        <aside class="sidebar">
            <h1>LIFE WEEKS</h1>
            <div class="soul-text">
                <span class="mobile-hidden">
                    80 å¹´ï¼Œ4,160 å‘¨ã€‚<br>
                    <strong class="black">é»‘è‰²</strong>æ˜¯å·²é€çš„è®°å¿†ï¼Œ
                    <strong class="black">ç™½è‰²</strong>æ˜¯æ— é™çš„å¯èƒ½ã€‚<br>
                    é‚£ä¸ªé—ªçƒçš„<strong class="red">çº¢è‰²</strong>ï¼Œå°±æ˜¯ç°åœ¨ã€‚

                    <br><br>
                    <!-- ä¸è¦åªæ˜¯çœ‹ç€å®ƒä»¬æ¶ˆå¤±ã€‚<br>
                    Fill them with life. -->
                    Make it count.
                </span>
                <span class="mobile-visible">
                    80 å¹´ï¼Œ4,160 å‘¨ã€‚<br>
                    é‚£ä¸ªé—ªçƒçš„<strong class="red">çº¢è‰²</strong>ï¼Œå°±æ˜¯ç°åœ¨ã€‚<br>
                    Make it count.
                </span>
            </div>
            <div class="input-group">
                <label>DATE OF BIRTH</label>
                <input type="date" id="birthdate" value="1995-01-01">
            </div>
            <div class="stats" id="stats"></div>
            
            <!-- <div class="help-section" id="helpSection">
                <div class="help-trigger" onclick="toggleHelp()">
                    > ä½¿ç”¨è¯´æ˜
                </div>
                <div class="help-content" id="helpContent">
                    <strong>ğŸ“± æ‰‹æœºç«¯æ“ä½œï¼š</strong><br>
                    â€¢ <strong>è½»ç‚¹ä¸€æ¬¡</strong>ï¼šé€‰ä¸­æ ¼å­ï¼ŒæŸ¥çœ‹å¹´ä»½ä¸å¹´é¾„ã€‚<br>
                    â€¢ <strong>å†æ¬¡ç‚¹å‡»</strong>ï¼šå¯¹å½“å‰æ ¼å­è¿›è¡Œç¼–è¾‘ã€‚<br>
                    â€¢ <strong>ç‚¹å‡»ç©ºç™½</strong>ï¼šå–æ¶ˆé€‰ä¸­ã€‚
                </div>
            </div>

            <div class="data-actions">
                <button class="action-btn" onclick="exportData()">Export</button>
                <button class="action-btn" onclick="document.getElementById('fileInput').click()">Import</button>
                <input type="file" id="fileInput" accept=".json" onchange="importData(this)">
            </div> -->

            <div class="hover-info" id="hoverInfo"></div>
        </aside>
        <main class="grid-container">
            <div id="grid" class="grid"></div>
        </main>
    </div>

<script>
    const gridEl = document.getElementById('grid');
    const dateInput = document.getElementById('birthdate');
    const statsEl = document.getElementById('stats');
    const hoverInfoEl = document.getElementById('hoverInfo');
    
    const TOTAL_YEARS = 80;
    const WEEKS_PER_YEAR = 52;
    const TOTAL_WEEKS = TOTAL_YEARS * WEEKS_PER_YEAR;

    let milestones = JSON.parse(localStorage.getItem('lifeGridMilestones')) || {};
    const savedBirthdate = localStorage.getItem('lifeGridBirthdate');
    if (savedBirthdate) { dateInput.value = savedBirthdate; }
    
    let lastClickedIndex = -1;

    function saveMilestones() {
        localStorage.setItem('lifeGridMilestones', JSON.stringify(milestones));
    }

    function toggleHelp() {
        const content = document.getElementById('helpContent');
        const section = document.getElementById('helpSection');
        content.classList.toggle('show');
        section.classList.toggle('active');
        
        if (window.innerWidth <= 768 && content.classList.contains('show')) {
             if (lastClickedIndex !== -1) {
                hoverInfoEl.textContent = '';
                const prev = document.querySelector('.cell.selected');
                if (prev) prev.classList.remove('selected');
                lastClickedIndex = -1;
            }
        }
    }

    function exportData() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(milestones));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "life-grid-data.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }

    function importData(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const importedData = JSON.parse(e.target.result);
                if (typeof importedData === 'object') {
                    if (confirm('Importing will overwrite current data. Continue?')) {
                        milestones = importedData;
                        saveMilestones();
                        renderGrid();
                        alert('Data imported successfully.');
                    }
                }
            } catch (error) { alert('Error reading file.'); }
        };
        reader.readAsText(file);
        input.value = '';
    }

    function renderGrid() {
        gridEl.innerHTML = '';
        const birthdate = new Date(dateInput.value);
        const today = new Date();
        localStorage.setItem('lifeGridBirthdate', dateInput.value);
        
        const oneWeek = 1000 * 60 * 60 * 24 * 7;
        let diffWeeks = Math.floor((today - birthdate) / oneWeek);
        if (diffWeeks < 0) diffWeeks = 0;
        if (diffWeeks > TOTAL_WEEKS) diffWeeks = TOTAL_WEEKS;

        const leftWeeks = TOTAL_WEEKS - diffWeeks;
        const percentage = ((diffWeeks / TOTAL_WEEKS) * 100).toFixed(1);
        
        statsEl.innerHTML = `
            Used: <strong>${diffWeeks}</strong> weeks (${percentage}%)<br>
            Remaining: <strong>${leftWeeks}</strong> weeks
        `;

        const fragment = document.createDocumentFragment();

        for (let i = 0; i < TOTAL_WEEKS; i++) {
            const div = document.createElement('div');
            div.className = 'cell';
            const age = Math.floor(i / WEEKS_PER_YEAR);
            const year = birthdate.getFullYear() + age;
            const isMilestone = milestones[i] ? true : false;
            const isPast = i < diffWeeks;
            const isCurrent = i === diffWeeks;
            const isBirth = (i === 0); // æ ¸å¿ƒé€»è¾‘ï¼šç¬¬ä¸€å‘¨æ˜¯å‡ºç”Ÿå‘¨

            // æ ·å¼ä¼˜å…ˆçº§ï¼šå‡ºç”Ÿ > é‡Œç¨‹ç¢‘ > ç°åœ¨ > è¿‡å»/æœªæ¥
            if (isPast) div.classList.add('past');
            else if (isCurrent) div.classList.add('current');
            else div.classList.add('future');

            if (isBirth) div.classList.add('birth'); // æ·»åŠ é‡‘è‰²ç±»
            else if (isMilestone) div.classList.add('milestone'); // å¦‚æœæ˜¯å‡ºç”Ÿå‘¨ï¼Œä¼˜å…ˆæ˜¾ç¤ºå‡ºç”Ÿè‰²ï¼Œå¦åˆ™æ˜¾ç¤ºé‡Œç¨‹ç¢‘è‰²

            const updateInfo = () => {
                hoverInfoEl.classList.remove('blue-text', 'gold-text');
                
                if (isBirth) {
                   // å‡ºç”Ÿå‘¨ç‰¹æ®Šæ–‡æ¡ˆ
                   hoverInfoEl.textContent = `ğŸ‘¶ Born in ${year}`;
                   hoverInfoEl.classList.add('gold-text');
                } else if (isMilestone) {
                    hoverInfoEl.textContent = `ğŸ“Œ ${milestones[i]} (Age ${age})`;
                    hoverInfoEl.classList.add('blue-text'); 
                } else if (isPast) {
                    hoverInfoEl.textContent = `${year} (Age ${age})`;
                } else if (isCurrent) {
                    hoverInfoEl.textContent = `NOW Â· æ­¤åˆ»`;
                } else {
                    hoverInfoEl.textContent = `${year} (Age ${age})`;
                }
            };

            const triggerEdit = () => {
                setTimeout(() => {
                    const currentVal = milestones[i] || '';
                    let promptText = '';
                    
                    if (isBirth) promptText = `Edit birth note (Clear to delete):`; // å‡ºç”Ÿå‘¨ç‰¹æ®Šæç¤º
                    else if (currentVal) promptText = `Edit note (Clear to delete):`;
                    else if (isPast) promptText = `Record a memory for Age ${age} (${year}):`;
                    else promptText = `Set a goal for Age ${age} (${year}):`;

                    const input = prompt(promptText, currentVal);
                    if (input !== null) {
                        if (input.trim() === '') delete milestones[i]; 
                        else milestones[i] = input.trim(); 
                        saveMilestones(); 
                        renderGrid(); 
                    }
                }, 50);
            };

            div.addEventListener('mouseenter', updateInfo);

            div.addEventListener('click', (e) => {
                e.stopPropagation();
                if (window.innerWidth <= 768) {
                    if (lastClickedIndex !== i) {
                        updateInfo();
                        const prev = document.querySelector('.cell.selected');
                        if (prev) prev.classList.remove('selected');
                        div.classList.add('selected');
                        lastClickedIndex = i;
                    } else {
                        triggerEdit();
                        div.classList.remove('selected');
                        lastClickedIndex = -1;
                    }
                } else {
                    updateInfo();
                    triggerEdit();
                }
            });

            fragment.appendChild(div);
        }
        gridEl.appendChild(fragment);

        gridEl.addEventListener('mouseleave', () => {
            if (window.innerWidth > 768) hoverInfoEl.textContent = ''; 
        });
        
        document.body.addEventListener('click', (e) => {
            if (e.target.closest('.help-trigger') || e.target.closest('.action-btn')) return;
            
            if (window.innerWidth <= 768 && !e.target.classList.contains('cell')) {
                if (lastClickedIndex !== -1) {
                    hoverInfoEl.textContent = '';
                    const prev = document.querySelector('.cell.selected');
                    if (prev) prev.classList.remove('selected');
                    lastClickedIndex = -1;
                }
                const helpContent = document.getElementById('helpContent');
                if (helpContent.classList.contains('show')) {
                    toggleHelp();
                }
            }
        });
    }
    renderGrid();
    dateInput.addEventListener('change', renderGrid);
</script>
</body>
</html>